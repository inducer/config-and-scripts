#! /bin/bash


export RESTIC_REPOSITORY="rest:https://aklightning:$(cat $HOME/.restic-repo-password)@sprout.d.tiker.net:8000/aklightning/lightning"
# export RESTIC_REPOSITORY="sftp:andreas@tuck:backup/laptop-restic"
export RESTIC_PASSWORD_FILE=$HOME/.restic-password

# https://stackoverflow.com/a/28776166
(return 0 2>/dev/null) && sourced=1 || sourced=0

if [[ $sourced = 0 ]]; then
    set -eo pipefail

    echo "dumping notmuch..."
    notmuch-dump
    echo "done"

    restic backup --verbose --one-file-system \
            "$HOME" /media/andreas/sd-bulk-tera/bulk-andreas \
            --exclude "$HOME/from-bolt" \
            --exclude "$HOME/mail/.notmuch/xapian" \
            --exclude "$HOME/.cache" \
            --exclude "$HOME/.wine" \
            --exclude "$HOME/Downloads" \
            --exclude "$HOME/.var/app/*/cache" \
            --exclude "$HOME/.vim/plugged" \
            --exclude "$HOME/.cargo" \
            --exclude "$HOME/.rustup" \
            --exclude "$HOME/.local/share/Trash" \
            --exclude "$HOME/.config/*/Cache" \
            --exclude "$HOME/.config/libvirt" \
            --exclude "$HOME/tmp" \
            --exclude "$HOME/.local/share/Steam" \
            --exclude "$HOME/.local/share/containers"
fi

# vim: shiftwidth=4
